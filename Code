#
# This is a Shiny web application. You can run the application by clicking
# the 'Run App' button above.
#
# Find out more about building applications with Shiny here:
#
#    http://shiny.rstudio.com/
#

#install.packages("ggplot2")
#install.packages("dplyr")

library(shiny)
library(ggplot2)
library(dplyr)

#import data
setwd("C:/Users/End User/Documents/DEGREE/sem 4/data science")
getwd()
stageData <- read.csv("Data.csv")

#initialize data
Loss <- stageData$loss_percentage
Stage <- stageData$food_supply_stage
Country <- stageData$country
df <- data.frame(Country, Stage, Loss)

# Define UI for application
ui <- fluidPage(
    navbarPage( 
      "Food Counsel", #app title
      
      #stage tab
      tabPanel( "Stage",
        h2("Stage of Food Waste"),
        br(),
        p("This tab will show the break down of dataset to identify at which stage does food waste occur the most."),
        br(),
        
        sidebarPanel(          
          h3("Tick for categorized figure"),
          
          #checkbox
          checkboxInput("cbCategorized", "Categorized", FALSE),
          
          h3("Dataset Table"),
          br(),
          
          #display table
          fluidRow(column(12, dataTableOutput("table"), align = "center")),
          
        ), #sidebar panel end

        mainPanel( 
        
          h2("Figure of percentage of food waste (%) sorted by stages of food waste for all country"),
          br(),
          
          #display graph
          plotOutput("plot")
          
        ) #main panel end
        
      ),#tab 1
      
      tabPanel("tab 2", h1("isi dlm ni code korang")), #tab 2 
      tabPanel("tab 3", h1("isi dlm ni code korang")), #tab 3
      
    ) #Navbar Page end
) #fluid Page end

# Define server 
server <- function(input, output) {

  #print table
  output$table <- renderDataTable(df)
  
  #print graph
  output$plot <- renderPlot({
    #if check box ticked
    if(input$cbCategorized == TRUE){
      ggplot(df, aes(x = Country, y = (Loss)), height = 2000) +
        geom_boxplot(aes(colour = Stage))+
        facet_wrap(~Stage) +
        ggtitle("Food Waste Stage") +
        xlab("Country") +
        ylab("Food Waste Percentage (%)") +
        scale_fill_gradient("Average", low="darkolivegreen1",high="deepskyblue3") +
        theme_bw(base_size = 15) +
        theme(axis.text.x = element_blank())
      
    } #if end
    #check box didnt ticked
    else{
    ggplot(df, aes(x = Country, y = (Loss)), height = 2000) +
    geom_boxplot(aes(colour = Stage))+
      ggtitle("Food Waste Stage") +
      xlab("Country") +
      ylab("Food Waste Percentage (%)") +
      scale_fill_gradient("Average", low="darkolivegreen1",high="deepskyblue3") +
      theme_bw(base_size = 15) +
      theme(axis.text.x = element_blank())
    } #else end
      
  }) #outputplot end
    
} #server end

# Run the application 
shinyApp(ui = ui, server = server)
